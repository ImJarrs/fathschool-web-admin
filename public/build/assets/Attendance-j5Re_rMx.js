import{_ as L}from"./AppLayout-D06oZWsy.js";import{_ as F,N as j,a2 as B,a3 as C,r as p,c as M,o as u,w as m,a as _,b as s,i as g,t as r,l as N,m as y,H as b,e as c,F as x,j as w,h as I,s as T,g as R,f as U}from"./app-B4siR4nP.js";import{_ as E}from"./Modal-DEp1tEtC.js";import"./autoprefixer-B9VU8ISz.js";import"./index-DtyboiO1.js";import"./TopBarMenu-nQHiLmrq.js";import"./CheckCircleIcon-DRQ2Sg4c.js";import"./XMarkIcon-BWTnXq2K.js";import"./WarningToast-C-jPV3vQ.js";import"./UserIcon-C-1rgfXS.js";import"./PlusCircleIcon-BZ251gFF.js";import"./Bars3Icon-C3NvXC29.js";const Y={components:{AppLayout:L,Breadcrumb:C,BreadcrumbLink:B,NothingFound:j,ExportModal:E},props:{attendancestudent:{type:Array,required:!0},filter_data:Object,settingTimeIn:Object,study_programs:Object,classes:Object},data(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1).toISOString().slice(0,10),l=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().slice(0,10);return{loading:!1,options:[],options2:[],export_options:[],visible:!1,export_visible:!1,show_user:"",export_data:U.useForm({type:"Excel",course:"all",study_program:"all"}),filter:{name:this.filter_data.keyword||"",start_date:this.filter_data.start_date||e,end_date:this.filter_data.end_date||l,course:this.filter_data.course??null,study_program:this.filter_data.study_program??null}}},watch:{filter_data:{handler(t){this.filter.name=t.keyword||"";const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10),o=new Date(e.getFullYear(),e.getMonth()+1,0).toISOString().slice(0,10);this.filter.start_date=t.start_date||l,this.filter.end_date=t.end_date||o,this.filter.course=t.course||null,this.filter.study_program=t.study_program||null},immediate:!0}},created(){this.options.push({value:"",label:"All"});for(const[t,e]of Object.entries(this.classes))this.options.push({value:e.slug,label:e.name});this.options2.push({value:"",label:"All"});for(const[t,e]of Object.entries(this.study_programs))this.options2.push({value:e.slug,label:e.name})},setup(t){return{attendancestudent:R(t.attendancestudent)}},computed:{datesInRange(){const t=new Date(this.filter.start_date),e=new Date(this.filter.end_date),l=[];for(let o=new Date(t);o<=e;o.setDate(o.getDate()+1)){const n=o.getDay();if(n===0||n===6)continue;let i=o.toISOString().slice(0,10);l.push(i)}return l},filteredAttendance(){return this.attendancestudent.filter(t=>{let e=!0;if(this.filter.name&&this.filter.name.trim()!==""){const l=this.filter.name.trim().toLowerCase();e=t.user_name&&t.user_name.toLowerCase().includes(l)}return e})}},methods:{filterData(){this.loading=!0;const t={keyword:this.filter.name||null,start_date:this.filter.start_date,end_date:this.filter.end_date,course:this.filter.course,study_program:this.filter.study_program};this.$inertia.get(this.route("report.attendance"),t,{preserveScroll:!0,onFinish:e=>{this.loading=!1,this.attendancestudent=e.props.attendance}})},exportAttendance(){var e,l;this.loading=!0;let t={start_date:this.filter.start_date,end_date:this.filter.end_date};(e=this.filter.name)!=null&&e.trim()&&(t.name=this.filter.name.trim()),this.filter.course&&(t.course=this.filter.course),(l=this.filter.study_program)!=null&&l.trim()&&(t.study_program=this.filter.study_program.trim()),T({url:this.route("studentattendance.export"),method:"POST",data:t,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},responseType:"blob"}).then(o=>{let n=new Blob([o.data]),i=window.URL.createObjectURL(n),d=document.createElement("a");d.href=i;let h=`studentattendance-${this.filter.start_date}_to_${this.filter.end_date}.xlsx`;d.setAttribute("download",h),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(i)}).catch(o=>{console.error("Export gagal:",o),alert("Terjadi kesalahan saat mengunduh file.")}).finally(()=>{this.loading=!1,this.visible=!1})}}},V={class:"mb-4"},q={class:"flex items-center"},H={class:"ml-4 flex items-center"},K={for:"start_date",class:"mr-2"},z={class:"ml-4 flex items-center"},P={for:"end_date",class:"mr-2"},X={type:"submit",class:"ml-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},G={class:"xl:col-span-2 bg-white dark:bg-gray-800 rounded-lg"},J={class:"flex justify-between items-center px-6 py-4"},Q={class:"text-gray-900 dark:text-gray-400 text-lg font-bold"},W={class:"overflow-x-auto shadow-md rounded-lg"},Z={class:"w-full text-sm text-center text-gray-700 dark:text-gray-300"},$={class:"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-200"},tt={rowspan:"2",class:"py-4 px-6"},et={rowspan:"2",class:"py-4 px-6"},st=["colspan"],at={class:"border-b border-gray-300"},rt={class:"py-4 px-6 font-medium"},ot={class:"py-4 px-6 font-medium"},nt={class:"py-4 px-6"},lt={class:"py-4 px-6 font-semibold dark:text-white"},it={class:"py-4 px-6 font-semibold dark:text-white"},dt={class:"py-4 px-6 font-semibold dark:text-white"},ut={class:"py-4 px-6 font-semibold dark:text-white"};function pt(t,e,l,o,n,i){const d=p("BreadcrumbLink"),h=p("Breadcrumb"),k=p("page-header"),v=p("a-select"),S=p("global-button"),O=p("AppLayout");return u(),M(O,{title:t.__("Student Attendance")},{header:m(()=>[g(r(t.__("Student Attendance")),1)]),default:m(()=>[_(h,null,{default:m(()=>[_(d,{title:t.__("Student Attendance"),href:t.route("student.attendance")},null,8,["title","href"])]),_:1}),s("div",null,[_(k,{class:"flex-col sm:flex-row"},{default:m(()=>[g(r(t.__("Student Attendance")),1)]),_:1}),s("div",V,[s("form",{onSubmit:e[4]||(e[4]=N((...a)=>i.filterData&&i.filterData(...a),["prevent"]))},[s("div",q,[y(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>n.filter.name=a),id:"name",placeholder:"Name",class:"p-2 border rounded"},null,512),[[b,n.filter.name]]),s("div",H,[s("label",K,r(t.__("From"))+":",1),y(s("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>n.filter.start_date=a),id:"start_date",class:"p-2 border rounded"},null,512),[[b,n.filter.start_date]])]),s("div",z,[s("label",P,r(t.__("To"))+":",1),y(s("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>n.filter.end_date=a),id:"end_date",class:"p-2 border rounded mr-4"},null,512),[[b,n.filter.end_date]])]),s("div",null,[_(v,{class:"width-100",size:"large",value:n.filter.course,"onUpdate:value":e[3]||(e[3]=a=>n.filter.course=a),"show-search":"",placeholder:t.__("Select a class"),options:n.options,"filter-option":t.filterOption,onFocus:t.handleFocus,onBlur:t.handleBlur,onChange:t.handleChange},null,8,["value","placeholder","options","filter-option","onFocus","onBlur","onChange"])]),s("button",X,r(t.__("Filter")),1)])],32)]),s("div",G,[s("div",J,[s("div",Q,r(t.__("Attendance List")),1),_(S,{loading:!1,onClick:i.exportAttendance,type:"button",theme:"sky"},{default:m(()=>[g(r(t.__("Export")),1)]),_:1},8,["onClick"])]),s("div",W,[s("table",Z,[s("thead",$,[s("tr",null,[e[5]||(e[5]=s("th",{rowspan:"2",class:"py-4 px-6"},"No",-1)),s("th",tt,r(t.__("Nama Siswa")),1),s("th",et,r(t.__("Kelas")),1),s("th",{colspan:i.datesInRange.length,class:"py-4 px-6"},r(t.__("Tanggal")),9,st),e[6]||(e[6]=s("th",{rowspan:"2",class:"py-4 px-6"},"Hadir",-1)),e[7]||(e[7]=s("th",{rowspan:"2",class:"py-4 px-6"},"Sakit",-1)),e[8]||(e[8]=s("th",{rowspan:"2",class:"py-4 px-6"},"Ijin",-1)),e[9]||(e[9]=s("th",{rowspan:"2",class:"py-4 px-6"},"Alfa",-1))]),s("tr",at,[(u(!0),c(x,null,w(i.datesInRange,(a,f)=>(u(),c("th",{key:f,class:"py-3 px-5"},r(a),1))),128))])]),s("tbody",null,[o.attendancestudent.length>0?(u(!0),c(x,{key:0},w(o.attendancestudent,(a,f)=>(u(),c("tr",{key:a.id,class:"border-b border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"},[s("td",rt,r(f+1),1),s("td",ot,r(a.user_name),1),s("td",nt,r(a.class||"-"),1),(u(!0),c(x,null,w(a.attendance,(D,A)=>(u(),c("td",{key:A,class:"py-4 px-6"},r(D||"-"),1))),128)),s("td",lt,r(a.summary.hadir),1),s("td",it,r(a.summary.sakit),1),s("td",dt,r(a.summary.ijin),1),s("td",ut,r(a.summary.alfa),1)]))),128)):I("",!0)])])])])])]),_:1},8,["title"])}const St=F(Y,[["render",pt],["__scopeId","data-v-02d200d0"]]);export{St as default};
