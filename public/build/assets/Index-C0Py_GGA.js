import{_ as O}from"./AppLayout-D06oZWsy.js";import{_ as F,N as B,a2 as C,a3 as T,r as c,c as M,o as p,w as m,a as h,b as a,i as g,t as s,l as N,m as y,H as b,e as u,F as x,j as w,h as j,s as I,g as R,f as U}from"./app-B4siR4nP.js";import{_ as E}from"./Modal-DEp1tEtC.js";import"./autoprefixer-B9VU8ISz.js";import"./index-DtyboiO1.js";import"./TopBarMenu-nQHiLmrq.js";import"./CheckCircleIcon-DRQ2Sg4c.js";import"./XMarkIcon-BWTnXq2K.js";import"./WarningToast-C-jPV3vQ.js";import"./UserIcon-C-1rgfXS.js";import"./PlusCircleIcon-BZ251gFF.js";import"./Bars3Icon-C3NvXC29.js";const Y={components:{AppLayout:O,Breadcrumb:T,BreadcrumbLink:C,NothingFound:B,ExportModal:E},props:{attendanceteacher:{type:Array,required:!0},filter_data:Object,study_programs:Object},data(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1).toISOString().slice(0,10),l=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().slice(0,10);return{loading:!1,options:[],export_options:[],visible:!1,export_visible:!1,show_user:"",export_data:U.useForm({type:"Excel",study_program:"all"}),filter:{name:this.filter_data.keyword||"",start_date:this.filter_data.start_date||e,end_date:this.filter_data.end_date||l,study_program:this.filter_data.study_program??null}}},watch:{filter_data:{handler(t){this.filter.name=t.keyword||"";const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10),o=new Date(e.getFullYear(),e.getMonth()+1,0).toISOString().slice(0,10);this.filter.start_date=t.start_date||l,this.filter.end_date=t.end_date||o,this.filter.course=t.course||null,this.filter.study_program=t.study_program||null},immediate:!0}},created(){this.options.push({value:"",label:"All"});for(const[t,e]of Object.entries(this.study_programs))this.options.push({value:e.slug,label:e.name})},setup(t){return{attendanceteacher:R(t.attendanceteacher)}},computed:{datesInRange(){const t=new Date(this.filter.start_date),e=new Date(this.filter.end_date),l=[];for(let o=new Date(t);o<=e;o.setDate(o.getDate()+1)){let n=o.toLocaleDateString("id-ID");l.push(n)}return l},filteredAttendance(){return this.attendancestudent.filter(t=>{let e=!0;if(this.filter.name&&this.filter.name.trim()!==""){const l=this.filter.name.trim().toLowerCase();e=t.user_name&&t.user_name.toLowerCase().includes(l)}return e})}},methods:{filterData(){this.loading=!0;const t={keyword:this.filter.name||null,start_date:this.filter.start_date,end_date:this.filter.end_date,study_program:this.filter.study_program};this.$inertia.get(this.route("teacher.attendance"),t,{preserveScroll:!0,onFinish:e=>{this.loading=!1,this.attendanceteacher=e.props.attendance}})},exportAttendance(){var e,l;this.loading=!0;let t={start_date:this.filter.start_date,end_date:this.filter.end_date};(e=this.filter.name)!=null&&e.trim()&&(t.name=this.filter.name.trim()),this.filter.course&&(t.course=this.filter.course),(l=this.filter.study_program)!=null&&l.trim()&&(t.study_program=this.filter.study_program.trim()),I({url:this.route("teacherattendance.export"),method:"POST",data:t,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},responseType:"blob"}).then(o=>{let n=new Blob([o.data]),i=window.URL.createObjectURL(n),d=document.createElement("a");d.href=i;let _=`teacherattendance-${this.filter.start_date}_to_${this.filter.end_date}.xlsx`;d.setAttribute("download",_),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(i)}).catch(o=>{console.error("Export gagal:",o),alert("Terjadi kesalahan saat mengunduh file.")}).finally(()=>{this.loading=!1,this.visible=!1})}}},V={class:"mb-4"},q={class:"flex items-center"},H={class:"ml-4 flex items-center"},K={for:"start_date",class:"mr-2"},P={class:"ml-4 flex items-center"},z={for:"end_date",class:"mr-2"},G={type:"submit",class:"ml-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},X={class:"xl:col-span-2 bg-white dark:bg-gray-800 rounded-lg"},J={class:"flex justify-between items-center px-6 py-4"},Q={class:"text-gray-900 dark:text-gray-400 text-lg font-bold"},W={class:"overflow-x-auto shadow-md rounded-lg"},Z={class:"w-full text-sm text-center text-gray-700 dark:text-gray-300"},$={class:"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-200"},tt={rowspan:"2",class:"py-4 px-6"},et={rowspan:"2",class:"py-4 px-6"},at=["colspan"],rt={class:"border-b border-gray-300"},st={class:"py-4 px-6 font-medium"},ot={class:"py-4 px-6 font-medium"},nt={class:"py-4 px-6"},lt={class:"py-4 px-6 font-semibold dark:text-white"},it={class:"py-4 px-6 font-semibold dark:text-white"},dt={class:"py-4 px-6 font-semibold dark:text-white"},pt={class:"py-4 px-6 font-semibold dark:text-white"};function ct(t,e,l,o,n,i){const d=c("BreadcrumbLink"),_=c("Breadcrumb"),k=c("page-header"),v=c("a-select"),D=c("global-button"),L=c("AppLayout");return p(),M(L,{title:t.__("Teacher Attendance")},{header:m(()=>[g(s(t.__("Teacher Attendance")),1)]),default:m(()=>[h(_,null,{default:m(()=>[h(d,{title:t.__("Teacher Attendance"),href:t.route("teacher.attendance")},null,8,["title","href"])]),_:1}),a("div",null,[h(k,{class:"flex-col sm:flex-row"},{default:m(()=>[g(s(t.__("Teacher Attendance")),1)]),_:1}),a("div",V,[a("form",{onSubmit:e[4]||(e[4]=N((...r)=>i.filterData&&i.filterData(...r),["prevent"]))},[a("div",q,[y(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>n.filter.name=r),id:"name",placeholder:"Name",class:"p-2 border rounded"},null,512),[[b,n.filter.name]]),a("div",H,[a("label",K,s(t.__("From"))+":",1),y(a("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>n.filter.start_date=r),id:"start_date",class:"p-2 border rounded"},null,512),[[b,n.filter.start_date]])]),a("div",P,[a("label",z,s(t.__("To"))+":",1),y(a("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>n.filter.end_date=r),id:"end_date",class:"p-2 border rounded mr-4"},null,512),[[b,n.filter.end_date]])]),a("div",null,[h(v,{class:"width-100",size:"large",value:n.filter.study_program,"onUpdate:value":e[3]||(e[3]=r=>n.filter.study_program=r),"show-search":"",placeholder:t.__("Select a study program"),options:n.options,"filter-option":t.filterOption,onFocus:t.handleFocus,onBlur:t.handleBlur,onChange:t.handleChange},null,8,["value","placeholder","options","filter-option","onFocus","onBlur","onChange"])]),a("button",G,s(t.__("Filter")),1)])],32)]),a("div",X,[a("div",J,[a("div",Q,s(t.__("Attendance List")),1),h(D,{loading:!1,onClick:i.exportAttendance,type:"button",theme:"sky"},{default:m(()=>[g(s(t.__("Export")),1)]),_:1},8,["onClick"])]),a("div",W,[a("table",Z,[a("thead",$,[a("tr",null,[e[5]||(e[5]=a("th",{rowspan:"2",class:"py-4 px-6"},"No",-1)),a("th",tt,s(t.__("Nama Guru")),1),a("th",et,s(t.__("Program Keahlian")),1),a("th",{colspan:i.datesInRange.length,class:"py-4 px-6"},s(t.__("Tanggal")),9,at),e[6]||(e[6]=a("th",{rowspan:"2",class:"py-4 px-6"},"Hadir",-1)),e[7]||(e[7]=a("th",{rowspan:"2",class:"py-4 px-6"},"Sakit",-1)),e[8]||(e[8]=a("th",{rowspan:"2",class:"py-4 px-6"},"Ijin",-1)),e[9]||(e[9]=a("th",{rowspan:"2",class:"py-4 px-6"},"Alfa",-1))]),a("tr",rt,[(p(!0),u(x,null,w(i.datesInRange,(r,f)=>(p(),u("th",{key:f,class:"py-3 px-5"},s(r),1))),128))])]),a("tbody",null,[o.attendanceteacher.length>0?(p(!0),u(x,{key:0},w(o.attendanceteacher,(r,f)=>(p(),u("tr",{key:r.id,class:"border-b border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"},[a("td",st,s(f+1),1),a("td",ot,s(r.name),1),a("td",nt,s(r.study_program||"-"),1),(p(!0),u(x,null,w(r.attendance,(S,A)=>(p(),u("td",{key:A,class:"py-4 px-6"},s(S||"-"),1))),128)),a("td",lt,s(r.summary.hadir),1),a("td",it,s(r.summary.sakit),1),a("td",dt,s(r.summary.ijin),1),a("td",pt,s(r.summary.alfa),1)]))),128)):j("",!0)])])])])])]),_:1},8,["title"])}const Dt=F(Y,[["render",ct],["__scopeId","data-v-8bc23d79"]]);export{Dt as default};
