import{_ as I}from"./AppLayout-pRkTteQX.js";import{P as H}from"./Pagination-BOIqYq_w.js";import{T as w}from"./ToolTip-BDAKiZ28.js";import{_ as A,r as n,c as D,o as x,w as a,a as l,b as s,i as c,t as d,l as k,h as O,m as v,p as g,k as m,f as S}from"./app-R3TKzMFz.js";import{F as B,m as P,a as L}from"./main-DabsMeR3.js";import{m as R}from"./main-Bk5HSv5c.js";import{m as N}from"./main-9gx3aQUK.js";import{s as W}from"./multiselect-S7NpFuS0.js";/* empty css                */import{_ as G}from"./Modal-BLSUD_Cv.js";import{r as z}from"./EyeIcon-CK2ADUCC.js";import{r as Y}from"./PencilSquareIcon-CBvao7ks.js";import{r as J}from"./TrashIcon-bv6UB_hV.js";import"./index-KXBnMdcv.js";import"./TopBarMenu-CcNsgK0k.js";import"./CheckCircleIcon-B4BTDw9l.js";import"./XMarkIcon-8_3jvOSV.js";import"./WarningToast-B-mvdry_.js";import"./UserIcon-CI54yQqe.js";import"./PlusCircleIcon-GzopV6YD.js";import"./Bars3Icon-BbGKyUny.js";const K={components:{AppLayout:I,ToolTip:w,Pagination:H,TrashIcon:J,PencilSquareIcon:Y,EyeIcon:z,ToolTip:w,CustomModal:G,FullCalendar:B,Multiselect:W},props:{routines:Object,schedules:Array,classes:Array,teachers:Array,query:Object},data(){return{modal_show:!1,loading:!1,eventDetailModal:!1,eventDeleteModal:!1,eventDrugModal:!1,filter:S.useForm({course_id:this.query.course_id??"",subject_id:this.query.subject_id??"",teacher_id:this.query.teacher_id??""}),calendarOptions:{locale:this.$page.props.locale,plugins:[P,L,R,N],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},buttonText:{prev:this.__("prev"),next:this.__("next"),today:this.__("today"),month:this.__("month"),week:this.__("week"),day:this.__("day"),list:this.__("list")},height:800,selectable:!0,editable:!0,initialView:"timeGridWeek",events:this.schedules,eventContent:function(t){return{html:t.event.title.replace(/<br>/g,"<br>")}},dateClick:this.dateClick,eventClick:this.eventClick,select:this.selectEvent,eventDrop:this.eventDropped,eventResize:this.eventResized},form:this.$inertia.form({id:"",weekname:"",weekday:"",start_time:"",end_time:"",class:"",teacher:"",subject:"",type:"",event:"only_me"}),subjects:[],filter_subjects:[],showEvent:null,draggedEvent:null,eventDeleteForm:S.useForm({id:null,event:"only_me"})}},watch:{notices:{deep:!0,handler(t,e){this.notices.forEach(i=>{this.notice.id==i.id&&(this.notice=i)})}},"form.class":{deep:!0,handler(t){this.loadSubjects("modal")}},"filter.course_id":{deep:!0,handler(t){this.loadSubjects("filter")}},eventDrugModal:{deep:!0,handler(t){t||this.draggedEvent!=null&&this.draggedEvent.revert()}}},methods:{async refreshSchedule(){let t=await axios.get(route("routine.refresh"));this.schedules=t.data,this.calendarOptions.events=t.data},async selectEvent(t){this.loading=!1,this.form.reset();let e=t.startStr,i=t.endStr;if(this.form.weekday=m(e).format("d"),this.form.weekname=m(e).format("dddd"),this.form.start_time=m(e).format("HH:mm:ss"),this.form.end_time=m(i).format("HH:mm:ss"),this.form.type="api",(await axios.post(route("checkweekend",this.form.weekday))).data){alert("You cannot create a routine on a weekend day.");return}this.loading=!1,this.modal_show=!0},async eventDropped(t){t.event.extendedProps.is_recurring?(this.draggedEvent=t,this.eventDrugModal=!0):(this.form.event="all_events",this.draggedEvent=t,this.eventDroppedUpdate())},async eventDroppedUpdate(){let e=this.draggedEvent.event,i=e.startStr,b=e.endStr,o=await axios.get(route("routine.details",e.id));this.form.id=e.id,this.form.weekday=m(i).format("d"),this.form.start_time=m(i).format("HH:mm:ss"),this.form.end_time=m(b).format("HH:mm:ss"),this.form.class=o.data.course_id,this.form.teacher=o.data.teacher_id,this.form.subject=o.data.subject_id,this.form.type="api",this.updateData(),this.draggedEvent=null,this.eventDrugModal=!1},async eventResized(t){t.event.extendedProps.is_recurring?(this.draggedEvent=t,this.eventDrugModal=!0):(this.form.event="all_events",this.draggedEvent=t,this.eventDroppedUpdate())},async updateData(){await axios.put(route("routine.update",this.form.id),this.form),this.form.reset()},async saveData(){this.loading=!0,this.form.id?this.form.put(this.route("routine.update",this.form.id),{preserveScroll:!0,onSuccess:()=>{this.loading=!1,this.modal_show=!1,this.form.reset(),window.location.reload()},onError:()=>{this.loading=!1}}):this.form.post(this.route("routine.store"),{preserveScroll:!0,onSuccess:()=>{this.loading=!1,this.modal_show=!1,this.form.reset(),window.location.reload()},onError:()=>{this.loading=!1}})},async eventClick(t){this.showEvent=t.event._def,console.log(t.event._def),this.eventDetailModal=!0},eventEdit(){this.$inertia.get(this.route("routine.edit",this.showEvent.publicId))},eventDeleteModalOpen(){this.showEvent.extendedProps.is_recurring?(this.eventDeleteForm.id=this.showEvent.publicId,this.eventDeleteModal=!0):(this.eventDeleteForm.id=this.showEvent.publicId,this.eventDeleteForm.event="all_events",this.eventDelete())},eventDelete(){return confirm("Are you sure ?")==!0&&this.eventDeleteForm.post(this.route("routine.delete"),{preserveScroll:!0,onSuccess:t=>{this.calendarOptions.events=this.schedules,this.eventDeleteForm.reset(),this.eventDeleteModal=!1,this.eventDetailModal=!1}}),!1},filterData(){this.filter.get(this.route("routine.index"),{preserveScroll:!0})},async loadSubjects(t){let e=t=="modal"?this.form.class:this.filter.course_id,i=await axios.get(route("fetch.subjects",e));t=="modal"?(this.subjects=[],this.subjects=i.data):(this.filter_subjects=[],this.filter_subjects=i.data)},filterData(){this.filter.get(this.route("routine.index"),{preserveScroll:!0})}},mounted(){this.loadSubjects("filter")}},Q={class:"rounded-lg mb-4 py-4 px-6 text-lg font-semibold text-left text-gray-900 bg-white dark:text-white dark:bg-gray-800"},X={class:"text-lg dark:text-white"},Z={class:"mt-0.5"},$={class:"mt-0.5"},ee={class:"mt-0.5"},te={class:"col-span-2 bg-white overflow-x-auto rounded-lg dark:bg-gray-800 p-6"},re={class:"p-6 dark:text-gray-400"},oe={class:"w-full"},se={class:"w-full p-4 dark:bg-gray-800 dark:border-gray-700 rounded-lg"},le={class:"mb-3"},ae=["value"],ie={class:"mb-3"},ne=["value"],de={class:"mb-3"},ue={class:"mb-3"},ce={class:"mb-3"},me={class:"flex justify-between gap-4"},fe=["innerHTML"],pe={class:"text-left"},he={class:"font-bold mb-2 mt-8"},ve={class:"flex items-center mb-2"},ge={class:"flex items-center mb-2"},be={class:"text-left"},_e={class:"font-bold mb-2 mt-8"},ye={class:"flex items-center mb-2"},ke={class:"flex items-center mb-2"};function we(t,e,i,b,o,f){const j=n("BreadcrumbLink"),C=n("Breadcrumb"),p=n("global-button"),M=n("page-header"),u=n("global-label"),h=n("Multiselect"),V=n("FullCalendar"),E=n("a-button"),_=n("input-error"),T=n("a-modal"),F=n("PencilSquareIcon"),U=n("TrashIcon"),y=n("custom-modal"),q=n("AppLayout");return x(),D(q,{title:t.__("Class Schedule")},{default:a(()=>[l(C,null,{default:a(()=>[l(j,{title:t.__("Class Schedule")},null,8,["title"])]),_:1}),s("div",null,[l(M,{class:"flex items-center justify-between"},{content:a(()=>[l(p,{loading:!1,type:"link",url:t.route("routine.create"),theme:"primary"},{default:a(()=>[c(d(t.__("Add New")),1)]),_:1},8,["url"])]),default:a(()=>[c(d(t.__("Class Schedule"))+" ",1)]),_:1}),s("div",Q,[s("h1",X,d(t.__("Filter By")),1),s("form",{class:"grid items-end grid-cols-1 xl:grid-cols-4 gap-[18px]",onSubmit:e[3]||(e[3]=k(r=>f.filterData(),["prevent"]))},[s("div",Z,[l(u,{for:"name",value:"Select Course",required:!1}),l(h,{id:"class",class:"dark:text-gray-900",modelValue:o.filter.course_id,"onUpdate:modelValue":e[0]||(e[0]=r=>o.filter.course_id=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Course"),options:i.classes.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"])]),s("div",$,[l(u,{for:"name",value:"Select Subject",required:!1}),l(h,{id:"subject",class:"dark:text-gray-900",modelValue:o.filter.subject_id,"onUpdate:modelValue":e[1]||(e[1]=r=>o.filter.subject_id=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Subject"),options:o.filter_subjects.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"])]),s("div",ee,[l(u,{for:"name",value:"Select Teacher",required:!1}),l(h,{id:"teacher",class:"dark:text-gray-900",modelValue:o.filter.teacher_id,"onUpdate:modelValue":e[2]||(e[2]=r=>o.filter.teacher_id=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Teacher"),options:i.teachers.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"])]),s("div",null,[l(p,{loading:o.filter.processing,type:"submit",theme:"primary"},{default:a(()=>[c(d(t.__("Apply Filter")),1)]),_:1},8,["loading"])])],32)]),s("div",te,[l(V,{options:o.calendarOptions,class:"min-w-[991px]"},null,8,["options"])])]),l(T,{visible:o.modal_show,"onUpdate:visible":e[8]||(e[8]=r=>o.modal_show=r),title:this.form.id?"Update Routine Schedule":"Create Routine Schedule",onOk:e[9]||(e[9]=r=>o.modal_show=!1)},{footer:a(()=>[l(E,{key:"back",onClick:e[4]||(e[4]=r=>o.modal_show=!1)},{default:a(()=>e[21]||(e[21]=[c("Close")])),_:1,__:[21]})]),default:a(()=>[s("div",re,[s("div",oe,[s("div",se,[s("div",le,[l(u,{for:"class",value:"Select Weekdays"}),s("input",{value:o.form.weekname,type:"text",class:"pl-4 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},null,8,ae)]),s("div",ie,[l(u,{for:"class",value:"Schedule Time"}),s("input",{value:o.form.start_time+" - "+o.form.end_time,type:"text",class:"pl-4 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},null,8,ne)]),s("div",de,[l(u,{for:"teacher",value:"Teacher",required:!0}),l(h,{id:"teacher",class:"dark:text-gray-900",modelValue:o.form.teacher,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.teacher=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Teacher"),options:i.teachers.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"]),l(_,{error:t.$page.props.errors.teacher},null,8,["error"])]),s("div",ue,[l(u,{for:"class",value:"Class",required:!0}),l(h,{id:"class",class:"dark:text-gray-900",modelValue:o.form.class,"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.class=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Course"),options:i.classes.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"]),l(_,{error:t.$page.props.errors.class},null,8,["error"])]),s("div",ce,[l(u,{for:"subject",value:"Subject",required:!0}),l(h,{id:"subject",class:"dark:text-gray-900",modelValue:o.form.subject,"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.subject=r),"close-on-select":!0,"can-clear":!1,searchable:!0,"create-option":!1,placeholder:t.__("Select Subject"),options:o.subjects.map(r=>({value:r.id,label:r.name})),autocomplete:"off"},null,8,["modelValue","placeholder","options"]),l(_,{error:t.$page.props.errors.subject},null,8,["error"])]),s("div",me,[o.form.id?(x(),D(p,{key:0,loading:o.loading,type:"button",onClick:k(t.deleteData,["prevent"]),class:"text-white bg-red-500 dark:bg-red-500 hover:bg-red-500 active:bg-red-600 dark:active:bg-red-600 focus:border-red-600 dark:focus:border-red-600 focus:ring focus:ring-red-300 w-full mt-3 dark:focus:ring-red-300"},{default:a(()=>[c(d(t.__("Delete")),1)]),_:1},8,["loading","onClick"])):O("",!0),l(p,{loading:o.loading,type:"button",onClick:k(f.saveData,["prevent"]),class:"text-white bg-blue-500 dark:bg-blue-500 hover:bg-blue-500 active:bg-blue-600 dark:active:bg-blue-600 focus:border-blue-600 dark:focus:border-blue-600 focus:ring focus:ring-blue-300 w-full mt-3 dark:focus:ring-blue-300"},{default:a(()=>[c(d(t.__("Save")),1)]),_:1},8,["loading","onClick"])])])])])]),_:1},8,["visible","title"]),l(y,{show:o.eventDetailModal,onClose:e[12]||(e[12]=r=>o.eventDetailModal=!1)},{title:a(()=>e[22]||(e[22]=[s("div",{class:"text-left"},null,-1)])),icon:a(()=>[s("div",{onClick:e[10]||(e[10]=r=>f.eventEdit()),class:"cursor-pointer"},[l(F,{class:"w-6 h-6 text-blue-500"})]),s("div",{onClick:e[11]||(e[11]=r=>f.eventDeleteModalOpen()),class:"cursor-pointer"},[l(U,{class:"w-6 h-6 text-pink-500"})])]),content:a(()=>{var r;return[s("div",{innerHTML:(r=o.showEvent)==null?void 0:r.title,class:"font-bold mb-2"},null,8,fe)]}),_:1},8,["show"]),l(y,{show:o.eventDeleteModal,onClose:e[16]||(e[16]=r=>o.eventDeleteModal=!1)},{title:a(()=>[s("div",pe,d(t.__("Delete event")),1)]),content:a(()=>[s("div",he,[s("div",ve,[v(s("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>o.eventDeleteForm.event=r),name:"event",id:"only_me",type:"radio",value:"only_me",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[g,o.eventDeleteForm.event]]),e[23]||(e[23]=s("label",{for:"only_me",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," This event ",-1))]),s("div",ge,[v(s("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>o.eventDeleteForm.event=r),name:"event",id:"all_events",type:"radio",value:"all_events",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[g,o.eventDeleteForm.event]]),e[24]||(e[24]=s("label",{for:"all_events",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," This and following events ",-1))])])]),footer:a(()=>[l(p,{onClick:e[15]||(e[15]=r=>f.eventDelete()),loading:o.eventDeleteForm.processing,type:"button",class:"mr-2"},{default:a(()=>[c(d(t.__("Delete")),1)]),_:1},8,["loading"])]),_:1},8,["show"]),l(y,{show:o.eventDrugModal,onClose:e[20]||(e[20]=r=>o.eventDrugModal=!1)},{title:a(()=>[s("div",be,d(t.__("Drag event")),1)]),content:a(()=>[s("div",_e,[s("div",ye,[v(s("input",{"onUpdate:modelValue":e[17]||(e[17]=r=>o.form.event=r),name:"event",id:"only_m1e",type:"radio",value:"only_me",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[g,o.form.event]]),e[25]||(e[25]=s("label",{for:"only_m1e",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," This event ",-1))]),s("div",ke,[v(s("input",{"onUpdate:modelValue":e[18]||(e[18]=r=>o.form.event=r),name:"event",id:"all_events1",type:"radio",value:"all_events",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[g,o.form.event]]),e[26]||(e[26]=s("label",{for:"all_events1",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," This and following events ",-1))])])]),footer:a(()=>[l(p,{onClick:e[19]||(e[19]=r=>f.eventDroppedUpdate()),loading:o.eventDeleteForm.processing,type:"button",class:"mr-2"},{default:a(()=>[c(d(t.__("Update")),1)]),_:1},8,["loading"])]),_:1},8,["show"])]),_:1},8,["title"])}const We=A(K,[["render",we]]);export{We as default};
