import{g as y,ab as H,e as r,o as e,b as i,a as n,d as N,w as s,i as u,n as k,t as C,Y as E,G as Y,f as A,I as Q,z,c as w,h as m,u as V,F as D,j as G}from"./app-R3TKzMFz.js";import{d as B}from"./index-KXBnMdcv.js";import{b as U,a as j}from"./DialogModal-CTY5hu_k.js";import{_ as P}from"./Button-DwQk9xI4.js";import{_ as I}from"./Input-CiDaXJoe.js";import{_ as L}from"./InputError-D0Jwtywh.js";import{_ as S}from"./SecondaryButton-Dyh5Bw1h.js";import{_ as O}from"./DangerButton-BKNxr24o.js";import{_ as W}from"./Label-DhHDipnk.js";const J={class:"mt-4"},h={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(x,{emit:T}){const c=T,a=y(!1),o=H({password:"",error:"",processing:!1}),p=y(null),_=()=>{axios.get(route("password.confirmation")).then(l=>{l.data.confirmed?c("confirmed"):(a.value=!0,setTimeout(()=>p.value.focus(),250))})},v=()=>{o.processing=!0,axios.post(route("password.confirm"),{password:o.password}).then(()=>{o.processing=!1,d(),Y().then(()=>c("confirmed"))}).catch(l=>{o.processing=!1,o.error=l.response.data.errors.password[0],p.value.focus()})},d=()=>{a.value=!1,o.password="",o.error=""};return(l,g)=>(e(),r("span",null,[i("span",{onClick:_},[N(l.$slots,"default")]),n(U,{show:a.value,onClose:d},{title:s(()=>[u(C(x.title),1)]),content:s(()=>[u(C(x.content)+" ",1),i("div",J,[n(I,{ref_key:"passwordInput",ref:p,modelValue:o.password,"onUpdate:modelValue":g[0]||(g[0]=F=>o.password=F),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",onKeyup:E(v,["enter"])},null,8,["modelValue"]),n(L,{message:o.error,class:"mt-2"},null,8,["message"])])]),footer:s(()=>[n(S,{onClick:d},{default:s(()=>g[1]||(g[1]=[u(" Cancel ")])),_:1,__:[1]}),n(P,{class:k(["ml-3 rtl:ml-0 rtl:mr-3",{"opacity-25":o.processing}]),disabled:o.processing,onClick:v},{default:s(()=>[u(C(x.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}},X={key:0,class:"text-lg dark:text-gray-400 font-medium text-gray-900"},Z={key:1,class:"text-lg dark:text-gray-400 font-medium text-gray-900"},ee={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-400"},te={key:3},oe={key:0},se={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ae={key:0,class:"font-semibold"},re={key:1},ne=["innerHTML"],le={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ie={class:"font-semibold"},ue=["innerHTML"],ce={key:1,class:"mt-4"},de={key:1},me={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg dark:text-gray-400"},fe={class:"mt-5"},pe={key:0},ve={key:1},Se={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(x){const T=x,c=y(!1),a=y(!1),o=y(!1),p=y(null),_=y(null),v=y([]),d=A.useForm({code:""}),l=Q(()=>{var f;return!c.value&&((f=A.usePage().props.value.user)==null?void 0:f.two_factor_enabled)});z(l,()=>{l.value||(d.reset(),d.clearErrors())});const g=()=>{c.value=!0,B.Inertia.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([F(),M(),$()]),onFinish:()=>{c.value=!1,a.value=T.requiresConfirmation}})},F=()=>axios.get("/user/two-factor-qr-code").then(f=>{p.value=f.data.svg}),M=()=>axios.get("/user/two-factor-secret-key").then(f=>{_.value=f.data.secretKey}),$=()=>axios.get("/user/two-factor-recovery-codes").then(f=>{v.value=f.data}),K=()=>{d.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{a.value=!1,p.value=null,_.value=null}})},q=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>$())},R=()=>{o.value=!0,B.Inertia.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{o.value=!1,a.value=!1}})};return(f,t)=>(e(),w(j,null,{content:s(()=>[l.value&&!a.value?(e(),r("h3",X," You have enabled two factor authentication. ")):l.value&&a.value?(e(),r("h3",Z," Finish enabling two factor authentication. ")):(e(),r("h3",ee," You have not enabled two factor authentication. ")),t[9]||(t[9]=i("div",{class:"mt-3 text-sm text-gray-600 dark:text-gray-400"},[i("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),l.value?(e(),r("div",te,[p.value?(e(),r("div",oe,[i("div",se,[a.value?(e(),r("p",ae," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(e(),r("p",re," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),i("div",{class:"mt-4",innerHTML:p.value},null,8,ne),_.value?(e(),r("div",le,[i("p",ie,[t[1]||(t[1]=u(" Setup Key: ")),i("span",{innerHTML:_.value},null,8,ue)])])):m("",!0),a.value?(e(),r("div",ce,[n(W,{for:"code",value:"Code"}),n(I,{id:"code",modelValue:V(d).code,"onUpdate:modelValue":t[0]||(t[0]=b=>V(d).code=b),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:E(K,["enter"])},null,8,["modelValue"]),n(L,{message:V(d).errors.code,class:"mt-2"},null,8,["message"])])):m("",!0)])):m("",!0),v.value.length>0&&!a.value?(e(),r("div",de,[t[2]||(t[2]=i("div",{class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[i("p",{class:"font-semibold dark:text-gray-400"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),i("div",me,[(e(!0),r(D,null,G(v.value,b=>(e(),r("div",{key:b},C(b),1))),128))])])):m("",!0)])):m("",!0),i("div",fe,[l.value?(e(),r("div",ve,[n(h,{onConfirmed:K},{default:s(()=>[a.value?(e(),w(P,{key:0,type:"button",class:k(["mr-3",{"opacity-25":c.value}]),disabled:c.value},{default:s(()=>t[4]||(t[4]=[u(" Confirm ")])),_:1,__:[4]},8,["class","disabled"])):m("",!0)]),_:1}),n(h,{onConfirmed:q},{default:s(()=>[v.value.length>0&&!a.value?(e(),w(S,{key:0,class:"mr-3"},{default:s(()=>t[5]||(t[5]=[u(" Regenerate Recovery Codes ")])),_:1,__:[5]})):m("",!0)]),_:1}),n(h,{onConfirmed:$},{default:s(()=>[v.value.length===0&&!a.value?(e(),w(S,{key:0,class:"mr-3"},{default:s(()=>t[6]||(t[6]=[u(" Show Recovery Codes ")])),_:1,__:[6]})):m("",!0)]),_:1}),n(h,{onConfirmed:R},{default:s(()=>[a.value?(e(),w(S,{key:0,class:k({"opacity-25":o.value}),disabled:o.value},{default:s(()=>t[7]||(t[7]=[u(" Cancel ")])),_:1,__:[7]},8,["class","disabled"])):m("",!0)]),_:1}),n(h,{onConfirmed:R},{default:s(()=>[a.value?m("",!0):(e(),w(O,{key:0,class:k({"opacity-25":o.value}),disabled:o.value},{default:s(()=>t[8]||(t[8]=[u(" Disable ")])),_:1,__:[8]},8,["class","disabled"]))]),_:1})])):(e(),r("div",pe,[n(h,{onConfirmed:g},{default:s(()=>[n(P,{type:"button",class:k({"opacity-25":c.value}),disabled:c.value},{default:s(()=>t[3]||(t[3]=[u(" Enable ")])),_:1,__:[3]},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Se as default};
